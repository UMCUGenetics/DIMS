params {
    resolution   = 140000 
    trim         = 0.4 # for testing purposes; normally 0.1
    standard_run = "no"
    ppm          = 5
    thresh       = 2000
    zscore       = 1
    matrix       = "plasma"
    dims_r_pack_image_path = '/hpc/dbg_mz/tools/singularity_cache/dims-1.1.img'
    raw_files_outputdir    = "$params.outdir/mzMLfiles/"
    scripts_dir            = "/hpc/dbg_mz/development/DIMS_Nextflow/CustomModules/DIMS/"
    hmdb_db_file           = "/hpc/dbg_mz/tools/db/HMDB_add_iso_corrected_V2.RData"
    relevance_file         = "/hpc/dbg_mz/tools/db/HMDB_with_info_relevance_corrected_V2.RData"

}

process {
    withLabel: 'ThermoRawFileParser_1_1_11' {
        cpus = 2
        memory = '1G'
        time = '10m'
    }

    withLabel: GenerateBreaks {
        cpus = 2
        memory = '5GB' 
        time =  '5m' 

        publishDir {
            path = "$params.outdir"
            mode = 'link'
        }
    }

    withLabel: 'HMDBparts' {
        cpus = 2
        memory = '10G'
        time = '60m'
    }

   withLabel: 'AssignToBins' {
        cpus = 2
        memory = '10G'
        time = '30m'
    }

    withLabel: AverageTechReplicates {
        cpus = 2
        memory = '50GB'
        time =  '20m'

        publishDir {
            path = "$params.outdir"
            mode = 'link'
            pattern = '*.txt'
        }
    }

    withLabel: 'PeakFinding' {
        cpus = 2
        memory = '10G'
        time = '20m'
    }

    withLabel: 'SpectrumPeakFinding' {
        cpus = 2
        memory = '10G'
        time = '10m'
    }

    withLabel: 'PeakGrouping' {
        cpus = 2
        memory = '1G'
        time = '60m'
    }

    withLabel: 'FillMissing' {
        cpus = 2
        memory = '1G'
        time = '10m'
    }

    withLabel: 'CollectFilled' {
        cpus = 2
        memory = '1G'
        time = '10m'
    }
    
    withLabel: 'SumAdducts' {
        cpus = 2
        memory = '1G'
        time = '30m'
    }

    withLabel: 'CollectSumAdducts' {
        cpus = 2
        memory = '1G'
        time = '10m'
    }

    withLabel: 'GenerateExcel' {
        cpus = 2
        memory = '1G'
        time = '30m'
    }

}

report {
    enabled = true
    file = "$params.outdir/log/nextflow_report.html"
}

trace {
    enabled = true
    file = "$params.outdir/log/nextflow_trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
}

timeline {
    enabled = true
    file = "$params.outdir/log/nextflow_timeline.html"
}

profiles {

    slurm {
        process {
            executor = 'slurm'
            queue = 'cpu'

            errorStrategy = 'retry'
            maxRetries = 1
        }

        singularity {
            enabled = true
            runOptions = '-B /hpc/dbg_mz:/hpc/dbg_mz -B $TMPDIR:$TMPDIR'
            autoMounts = true
            cacheDir = '/hpc/dbg_mz/tools/singularity_cache'
        }

        executor {
            queueSize = 1000
            pollInterval = '1min'
            queueStatInterval = '5min'
            submitRatelimit = '10sec'
        }

        mail {
            smtp.host = 'localhost'
        }
    }
}

